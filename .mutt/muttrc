#
# Thanks to https://wiki.archlinux.org/index.php/Mutt for much of this config
#
# # use the following if using native smtp
# # get encrypted password
# source "gpg2 -dq ~/.mutt-passwords.gpg |"
# set my_pass=$my_pw_main
# set smtp_url=smtp://$my_user:$my_pass@mail.swalladge.id.au:25
# set ssl_force_tls = yes
# set ssl_starttls = yes

set my_user=samuel@swalladge.id.au

source ~/.mutt/solarized-dark16.theme

# inbox
set mbox_type=Maildir
set folder=~/Maildir
set spoolfile=+INBOX
set header_cache=~/.cache/mutt
set record = +Sent
set postponed = +Drafts
# set imap_user = $my_user

# allows for refreshing the view more often
set timeout=30

source ~/.mutt/muttrc.mailboxes

# sending mail
set sendmail = "/usr/bin/msmtp"
set edit_headers = yes
set realname = 'Samuel Walladge'
set from = $my_user
set use_from = yes

set maildir_trash = no

# delete/trash messages from index
folder-hook . 'macro index d ":set confirmappend=no delete=yes\n<tag-prefix><save-message>+Trash\n<sync-mailbox>:set confirmappend=yes delete=ask-yes\n" "move message to Trash"'
folder-hook =Trash 'macro index d <delete-message>'

# delete/trash messages from pager
folder-hook . 'macro pager d ":set confirmappend=no delete=yes\n<save-message>+Trash\n<sync-mailbox>:set confirmappend=yes delete=ask-yes\n" "move message to Trash"'
folder-hook =Trash 'macro pager d <delete-message>'

set mailcap_path 	= ~/.mutt/mailcap
# folder-hook . `rm -r /tmp/mutt/*`

set editor=`echo \$EDITOR`
auto_view text/html
alternative_order text/plain text/html

set crypt_use_gpgme = yes
set crypt_autosign = yes
set pgp_auto_decode = yes

set sort = 'threads'
set sort_aux = 'last-date-received'

set signature="~/.mutt/sig"


# keybindings
bind pager j next-line
bind pager k previous-line
bind index G last-entry
bind pager G bottom
bind index K first-entry
bind pager K top
bind pager \004 half-down # <c-d>
bind pager \025 half-up   # <c-u>
bind index \004 half-down # <c-d>
bind index \025 half-up   # <c-u>

macro attach 'V' "<pipe-entry>cat >~/.cache/mutt-temp-email.html && $BROWSER ~/.cache/mutt-temp-email.html<enter>" \
      "view html attachments or message in browser"

set query_command= "khard email -p %s"
bind editor <Tab> complete-query
bind editor ^T    complete

# save sender address to contacts
macro index,pager S \
    "<pipe-message>khard add-email<return>" \
    "add the sender email address to khard"

macro index <F4> "<shell-escape>offlineimap -o<enter>" \
      "check for new emails now"

macro index <F5> "<shell-escape>vdirsyncer sync<enter>" \
      "syncronize contacts with server"

macro index A ":set confirmappend=no delete=yes\n<tag-prefix><save-message>+Archive\n<sync-mailbox>:set confirmappend=yes delete=ask-yes\n" "move message to Archive"

